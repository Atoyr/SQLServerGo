<!DOCTYPE html>
<html lang="en">
<head>
<title>Chat Example</title>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {packages: ['corechart', 'line']});
  var readoptions = {
    hAxis: {
      title: 'Time'
    },
    vAxis: {
      title: 'read',
      viewWindow: {min: 0},
    },
    explorer: {
      axis: 'horizonatal',
      keepInBounds: true,
    },
    crosshair: {
      color: '#000',
      trigger: 'selection'
    }
  };
  var writeoptions = {
    hAxis: {
      title: 'Time'
    },
    vAxis: {
      title: 'write',
      viewWindow: {min: 0},
    },
    explorer: {
      axis: 'horizonatal',
      keepInBounds: true,
    },
    crosshair: {
      color: '#000',
      trigger: 'selection'
    }
  };
  window.onload = function () {
    var readchart = new google.visualization.LineChart(document.getElementById('read_chart_div'));
    var writechart = new google.visualization.LineChart(document.getElementById('write_chart_div'));
    var readdata = new google.visualization.DataTable();
    var writedata = new google.visualization.DataTable();
    function drawChart(){
      readchart.draw(readdata, readoptions)
      writechart.draw(writedata, writeoptions)
    }

    var addedcolumn = false
    const chartSize = 100
    
    if (window["WebSocket"]) {
      conn = new WebSocket("ws://" + document.location.host + "/ws");
      conn.onmessage = function (evt) {
        var messages = JSON.parse(evt.data);
        var readrow = new Array(messages.length + 1);
        var writerow = new Array(messages.length + 1);
        if (!addedcolumn && messages.length > 0) {
          readdata.addColumn('datetime','time');
          writedata.addColumn('datetime','time');
          for (var i = 0;i < messages.length; i++){
            readdata.addColumn('number',messages[i].file_name);
            writedata.addColumn('number',messages[i].file_name);
          }
          
          addedcolumn = true
        }

        readrow[0] =  new Date(messages[0].datetime)
        writerow[0] =  new Date(messages[0].datetime)
          for (var i = 0;i < messages.length; i++){
             readrow[i + 1] = messages[i].read_bytes_per_sec
             writerow[i + 1] = messages[i].write_bytes_per_sec
          }
        readdata.addRows([readrow])
        writedata.addRows([writerow])
        if (readdata.length > chartSize) {
          readdata.removeRow(0)
          writedata.removeRow(0)
        }
        drawChart()
      };
    } 
};
</script>
</head>
<body>
<div id="read_chart_div" style="height:500px"></div>
<div id="write_chart_div" style="height:500px"></div>
</body>
</html>